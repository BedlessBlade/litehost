#!/bin/bash
set -e

if [ -f /etc/debian_version ]; then
    echo "Debian/Ubuntu detected."
    sudo apt update
    sudo apt install -y python3 python3-pip git openssh-server
elif [ -f /etc/arch-release ]; then
    echo "Arch Linux detected."
    sudo pacman -Sy --noconfirm python python-pip git openssh
elif [ -f /etc/redhat-release ]; then
    echo "Rocky/RHEL/CentOS detected."
    sudo dnf install -y epel-release
    sudo dnf install -y python3 python3-pip git openssh-server
elif [ -f /etc/void-release ]; then
    echo "Void Linux detected."
    sudo xbps-install -Sy python3 python3-pip git openssh
elif [ "$(uname)" = "FreeBSD" ]; then
    echo "FreeBSD detected."
    sudo pkg update
    sudo pkg install -y python3 py39-pip git openssh
elif [ "$(uname)" = "OpenBSD" ]; then
    echo "OpenBSD detected."
    doas pkg_add python%3.9 py3-pip git openssh
elif [ "$(uname)" = "NetBSD" ]; then
    echo "NetBSD detected."
    sudo pkgin update
    sudo pkgin install python39 py39-pip git openssh
else
    echo "Unsupported OS. Please install Python 3, pip, git, and openssh-server manually."
    exit 1
fi

echo "All dependencies installed."
echo "You can now run the node manager with: python3 main.py"
